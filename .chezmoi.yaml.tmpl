{{- $homebrewInstallType := "" }}
{{- $homebrewPath := "" }}
{{- if eq .chezmoi.os "darwin" }}
{{-   if hasKey . "homebrewInstallType" }}
{{-     $homebrewInstallType = .homebrewInstallType }}
{{-   else }}
{{-     $homebrewInstallType = promptChoice "How would you like to install Homebrew on this Mac?" (list "standard" "alternative") }}
{{-   end }}
{{-   if eq $homebrewInstallType "alternative" }}
{{-     if hasKey . "homebrewPath" }}
{{-       $homebrewPath = .homebrewPath }}
{{-     else }}
{{-       $homebrewPath = promptString "Enter the homebrew installation path (relative to home directory)" ".homebrew" }}
{{-     end }}
{{-   end }}
{{- end }}

{{- $skip1Password := false }}
{{- if hasKey . "skip1Password" }}
{{-   $skip1Password = .skip1Password }}
{{- else if env "CHEZMOI_SKIP_1PASSWORD" }}
{{-   $skip1Password = true }}
{{- else }}
{{-   $skip1Password = false }}
{{- end }}

{{- $prewarmRubyLSP := false }}
{{- if hasKey . "prewarmRubyLSP" }}
{{-   $prewarmRubyLSP = .prewarmRubyLSP }}
{{- else }}
{{-   $prewarmRubyLSP = promptBool "Prewarm Ruby LSP on Emacs startup? (recommended for work machines)" false }}
{{- end }}

{{- $ollamaHost := "localhost:11434" }}
{{- if hasKey . "ollamaHost" }}
{{-   $ollamaHost = .ollamaHost }}
{{- else }}
{{-   $ollamaHost = promptString "Ollama host (use 'localhost:11434' for local, or hostname:port for remote)" "localhost:11434" }}
{{- end }}

{{- $pullOllamaModels := false }}
{{- if eq $ollamaHost "localhost:11434" }}
{{-   if hasKey . "pullOllamaModels" }}
{{-     $pullOllamaModels = .pullOllamaModels }}
{{-   else }}
{{-     $pullOllamaModels = promptBool "Pull Ollama models for local development?" false }}
{{-   end }}
{{- end }}

{{- $useLlamaSwap := false }}
{{- if hasKey . "useLlamaSwap" }}
{{-   $useLlamaSwap = .useLlamaSwap }}
{{- else }}
{{-   $useLlamaSwap = promptBool "Use llama-swap for Aider instead of cloud models?" false }}
{{- end }}

{{- $llamaSwapApiBase := "http://localhost:8080/v1" }}
{{- if $useLlamaSwap }}
{{-   if hasKey . "llamaSwapApiBase" }}
{{-     $llamaSwapApiBase = .llamaSwapApiBase }}
{{-   else }}
{{-     $llamaSwapApiBase = promptString "Enter llama-swap API base URL" "http://localhost:8080/v1" }}
{{-   end }}
{{- end }}

{{- $preferredShell := "/bin/sh" }}
{{- if lookPath "fish" }}
{{-   $preferredShell = lookPath "fish" }}
{{- else if lookPath "zsh" }}
{{-   $preferredShell = lookPath "zsh" }}
{{- else if lookPath "bash" }}
{{-   $preferredShell = lookPath "bash" }}
{{- end }}

data:
{{- if eq .chezmoi.os "darwin" }}
  homebrewInstallType: {{ $homebrewInstallType | quote }}
{{-   if eq $homebrewInstallType "alternative" }}
  homebrewPath: {{ $homebrewPath | quote }}
{{-   end }}
{{-   $brewBin := "" }}
{{-   if lookPath "brew" }}
{{-     $brewBin = lookPath "brew" }}
{{-   else if eq $homebrewInstallType "alternative" }}
{{-     $brewBin = printf "%s/%s/bin/brew" .chezmoi.homeDir $homebrewPath }}
{{-   else }}
{{-     $brewBin = "/opt/homebrew/bin/brew" }}
{{-   end }}
  brewBin: {{ $brewBin | quote }}
{{- end }}
  skip1Password: {{ $skip1Password }}
  prewarmRubyLSP: {{ $prewarmRubyLSP }}
  ollamaHost: {{ $ollamaHost | quote }}
  ollamaApiBase: {{ printf "http://%s" $ollamaHost | quote }}
  pullOllamaModels: {{ $pullOllamaModels }}
  useLlamaSwap: {{ $useLlamaSwap }}
  llamaSwapApiBase: {{ $llamaSwapApiBase | quote }}
  preferredShell: {{ $preferredShell | quote }}
