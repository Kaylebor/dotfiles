#!/usr/bin/env bash
{{- if (not (lookPath "brew")) }}
# Install Homebrew
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
{{- end }}
{{- template "brew_eval" . }}
# Install Homebrew packages
brew bundle --file="{{ .chezmoi.sourceDir }}/dot_config/brewfile/Brewfile"

# Install Mise tools
mise install

{{- if lookPath "atuin" }}
# Use atuin for history management
if ! atuin status | rg '\[Remote\]'>/dev/null 2>&1; then
  atuin login -u "{{ onepasswordRead "op://Private/Atuin/username" }}" -p "{{ onepasswordRead "op://Private/Atuin/password" }}" -k "{{ onepasswordRead "op://Private/Atuin/key" }}"
fi
{{- end }}

nvim --headless +PlugInstall +qall
