{{- template "brew_eval" . }}
eval "$(mise activate bash --shims)" # Mise shims for early PATH access

{{- if and (eq .chezmoi.os "darwin") (eq .homebrewInstallType "alternative") }}
# Install Homebrew Casks to home directory (MDM-restricted systems use alternative installation)
export HOMEBREW_CASK_OPTS="--appdir=$HOME/Applications"
{{- end }}

{{- if eq .chezmoi.os "darwin" }}
# Increase file descriptor limit for development work (macOS)
ulimit -n 65536 2>/dev/null || true

if [ -z "${__SSH_KEYCHAIN_LOADED:-}" ] && command -v ssh-add >/dev/null 2>&1; then
  ssh-add --apple-load-keychain >/dev/null 2>&1 || true
  export __SSH_KEYCHAIN_LOADED=1
fi

# Set up gcc paths for alternative Homebrew installations
export LANG=en_US.UTF-8
{{- if and (hasKey . "homebrewInstallType") (eq .homebrewInstallType "alternative") }}
{{- if and (hasKey . "homebrewPaths") (stat .homebrewPaths.gccBase) }}
# Library paths
{{- if stat .homebrewPaths.gccLib }}
export LIBRARY_PATH="$HOME/{{ .homebrewPath }}/opt/gcc/lib/gcc/current:$LIBRARY_PATH"
{{- end }}

# C/C++ include paths
{{- if stat .homebrewPaths.gccInclude }}
export C_INCLUDE_PATH="$HOME/{{ .homebrewPath }}/opt/gcc/include:$C_INCLUDE_PATH"
{{- end }}
{{- if stat .homebrewPaths.gccCppInclude }}
export CPLUS_INCLUDE_PATH="$HOME/{{ .homebrewPath }}/opt/gcc/include/c++/15:$CPLUS_INCLUDE_PATH"
{{- end }}

# Set CC and CXX to use the Homebrew gcc
{{- if stat .homebrewPaths.gccBin }}
export CC=gcc-15
export CXX=g++-15
{{- end }}
{{- end }}
{{- end }}
{{- end }}
